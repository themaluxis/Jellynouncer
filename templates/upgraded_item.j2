{
  "embeds": [
    {
      "title": "â¬†ï¸ {{ item.item_type }} {% if changes|length == 1 %}{{ changes[0].type|title }} {% endif %}Upgraded",
      "description": "{% if item.item_type == 'Episode' %}**{{ item.series_name }}** S{{ '%02d'|format(item.season_number or 0) }}E{{ '%02d'|format(item.episode_number or 0) }}\n{{ item.name }}{% else %}**{{ item.name }}**{% if item.year %} ({{ item.year }}){% endif %}{% endif %}",
      "color": {{ color }},
      {% if item.item_type == 'Episode' and item.series_id %}
      "author": {
        "name": "{{ item.series_name }}",
        "icon_url": "{{ jellyfin_url }}/Items/{{ item.series_id }}/Images/Logo?api_key={{ api_key }}&maxHeight=64&maxWidth=200",
        "url": "{{ jellyfin_url }}/web/index.html#!/details?id={{ item.series_id }}"
      },
      {% endif %}
      "fields": [
        {# Change summary (non-inline for emphasis) #}
        {% for change in changes[:3] %}
        {
          "name": "{% if change.type == 'resolution' %}ğŸ“ Resolution Upgrade{% elif change.type == 'codec' %}ğŸï¸ Video Codec Upgrade{% elif change.type == 'audio_codec' %}ğŸ”Š Audio Codec Upgrade{% elif change.type == 'audio_channels' %}ğŸ”Š Audio Channels Upgrade{% elif change.type == 'hdr_status' %}ğŸŒˆ HDR Status Upgrade{% elif change.type == 'file_size' %}ğŸ’¾ File Replaced{% elif change.type == 'provider_ids' %}ğŸ”— Metadata Updated{% else %}ğŸ”„ {{ change.type|title }} Upgrade{% endif %}",
          "value": "{% if change.type == 'resolution' %}{{ change.old_value or 'Unknown' }}p â†’ **{{ change.new_value or 'Unknown' }}p**{% elif change.type == 'codec' %}{{ change.old_value or 'Unknown' }} â†’ **{{ change.new_value or 'Unknown' }}**{% elif change.type == 'audio_codec' %}{{ change.old_value or 'Unknown' }} â†’ **{{ change.new_value or 'Unknown' }}**{% elif change.type == 'audio_channels' %}{{ change.old_value or 0 }} ch â†’ **{{ change.new_value or 0 }} ch**{% elif change.type == 'hdr_status' %}{{ change.old_value or 'SDR' }} â†’ **{{ change.new_value or 'SDR' }}**{% elif change.type == 'file_size' %}File replaced with {% if item.file_size %}{{ "%.1f"|format(item.file_size / 1073741824) }}GB{% else %}new version{% endif %}{% elif change.type == 'provider_ids' %}{{ change.description }}{% else %}{{ change.description }}{% endif %}",
          "inline": {% if loop.index <= 2 %}true{% else %}false{% endif %}
        }{% if not loop.last %},{% endif %}
        {% endfor %}

        {# Current technical specifications (inline for space efficiency) #}
        {% if changes|length <= 2 %}
        ,{
          "name": "ğŸ“ Current Quality",
          "value": "{% if item.video_height %}{{ item.video_height }}p{% else %}Unknown{% endif %}{% if item.video_range and item.video_range != 'SDR' %} {{ item.video_range }}{% endif %}",
          "inline": true
        }
        {% if item.video_codec %}
        ,{
          "name": "ğŸï¸ Current Codec",
          "value": "{{ item.video_codec.upper() }}{% if item.video_profile %} ({{ item.video_profile }}){% endif %}",
          "inline": true
        }
        {% endif %}
        {% if item.audio_codec %}
        ,{
          "name": "ğŸ”Š Current Audio",
          "value": "{{ item.audio_codec.upper() }}{% if item.audio_channels %} {{ item.audio_channels }}.{% if item.audio_channels > 2 %}1{% else %}0{% endif %}{% endif %}",
          "inline": true
        }
        {% endif %}
        {% endif %}

        {# Runtime and metadata (inline) #}
        {% if item.runtime_ticks %}
        ,{
          "name": "â±ï¸ Runtime",
          "value": "{{ (item.runtime_ticks // 600000000) }}m",
          "inline": true
        }
        {% endif %}
        {% if item.official_rating %}
        ,{
          "name": "ğŸ·ï¸ Rating",
          "value": "{{ item.official_rating }}",
          "inline": true
        }
        {% endif %}
        {% if item.premiere_date %}
        ,{
          "name": "ğŸ“… {% if item.item_type == 'Episode' %}Air Date{% else %}Release{% endif %}",
          "value": "{{ item.premiere_date[:10] }}",
          "inline": true
        }
        {% endif %}

        {# External ratings (non-inline for better mobile display) #}
        {% if ratings and ratings|length > 0 %}
        ,{
          "name": "â­ Ratings",
          "value": "{% for rating_key, rating_data in ratings.items() %}{% if rating_key == 'imdb' %}**IMDb:** {{ rating_data.value }}/{{ rating_data.scale }}{% elif rating_key == 'rotten_tomatoes' %}**RT:** {{ rating_data.value }}%{% elif rating_key == 'metacritic' %}**MC:** {{ rating_data.value }}/{{ rating_data.scale }}{% elif rating_key == 'tmdb' %}**TMDb:** {{ rating_data.value }}/{{ rating_data.scale }}{% if rating_data.vote_count %} ({{ rating_data.vote_count }} votes){% endif %}{% elif rating_key == 'tvdb' %}**TVDb:** {{ rating_data.value }}/{{ rating_data.scale }}{% endif %}{% if not loop.last %} â€¢ {% endif %}{% endfor %}",
          "inline": false
        }
        {% endif %}

        {# External links (non-inline) #}
        {% if item.imdb_id or item.tmdb_id or item.tvdb_id %}
        {
          "name": "ğŸ”— External Links",
          "value": "{% if item.imdb_id %}[IMDb](https://www.imdb.com/title/{{ item.imdb_id }}/){% endif %}{% if item.tmdb_id %}{% if item.imdb_id %} â€¢ {% endif %}[TMDb](https://www.themoviedb.org/{% if item.item_type == 'Movie' %}movie{% elif item.item_type == 'Series' %}tv{% else %}tv{% endif %}/{{ item.tmdb_id }}){% endif %}{% if item.tvdb_id %}{% if item.imdb_id or item.tmdb_id %} â€¢ {% endif %}{% if ratings.tvdb and ratings.tvdb.proper_url %}[TVDb]({{ ratings.tvdb.proper_url }}){% elif item.item_type == 'Episode' %}[TVDb](https://thetvdb.com/episodes/{{ item.tvdb_id }}){% elif item.item_type == 'Series' %}[TVDb](https://thetvdb.com/series/{{ item.tvdb_id }}){% else %}[TVDb](https://thetvdb.com/dereferrer/series/{{ item.tvdb_id }}){% endif %}{% endif %}",
          "inline": false
        }
        {% endif %}
      ]{% if has_thumbnail %},
      "thumbnail": {
        "url": "{{ verified_thumbnail_url }}"
      }{% endif %},
      "footer": {
        "text": "Updated in Jellyfin â€¢ {{ timestamp[:19] | replace('T', ' ') }} UTC{% if tvdb_attribution_needed %}\nMetadata provided by TheTVDB{% endif %}",
        "icon_url": "{{ jellyfin_url }}/web/favicon.ico"
      },
      "timestamp": "{{ timestamp }}"
    }
  ]
}