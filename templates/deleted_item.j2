{#
  Mod√®le Jinja2 Discord Webhook pour √©l√©ments supprim√©s - Jellynouncer
  ===================================================================

  Ce mod√®le g√©n√®re des messages Discord int√©gr√©s pour les √©l√©ments multim√©dias supprim√©s.
  Il fournit des notifications propres et informatives lorsque le contenu est retir√© de Jellyfin.

  Limites Discord respect√©es :
  ----------------------------
  - Max 256 caract√®res pour le titre
  - Max 4096 caract√®res pour la description
  - Max 25 champs (nous utilisons ~5-10)
  - Max 1024 caract√®res par valeur de champ
  - Max 6000 caract√®res total par embed
#}
{
  "embeds": [
    {
      {#
        Titre dynamique bas√© sur le type d'√©l√©ment
        -------------------------------------------
        Affiche l'emoji et le libell√© appropri√©s pour le contenu supprim√©
      #}
      "title": {% if item.item_type == 'Episode' -%}
        {{ ("üóëÔ∏èüì∫ " ~ (item.name | default('√âpisode inconnu') | truncate(200, True, '‚Ä¶'))) | tojson }}
      {%- elif item.item_type == 'Series' -%}
        {{ ("üóëÔ∏èüì∫ " ~ (item.name | default('S√©rie inconnue') | truncate(200, True, '‚Ä¶'))) | tojson }}
      {%- elif item.item_type == 'Movie' -%}
        {{ ("üóëÔ∏èüé¨ " ~ (item.name | default('Film inconnu') | truncate(200, True, '‚Ä¶'))) | tojson }}
      {%- elif item.item_type == 'Season' -%}
        {{ ("üóëÔ∏èüì∫ " ~ (item.series_name | default('S√©rie inconnue')) ~ " - Saison " ~ (item.season_number | default('?'))) | tojson }}
      {%- elif item.item_type == 'Audio' -%}
        {{ ("üóëÔ∏èüéµ " ~ (item.name | default('Chanson inconnue') | truncate(200, True, '‚Ä¶'))) | tojson }}
      {%- elif item.item_type == 'MusicAlbum' -%}
        {{ ("üóëÔ∏èüíø " ~ (item.name | default('Album inconnu') | truncate(200, True, '‚Ä¶'))) | tojson }}
      {%- elif item.item_type == 'MusicArtist' -%}
        {{ ("üóëÔ∏èüé§ " ~ (item.name | default('Artiste inconnu') | truncate(200, True, '‚Ä¶'))) | tojson }}
      {%- elif item.item_type == 'Photo' -%}
        {{ ("üóëÔ∏èüì∑ " ~ (item.name | default('Photo supprim√©e') | truncate(200, True, '‚Ä¶'))) | tojson }}
      {%- else -%}
        {{ ("üóëÔ∏èüìÅ " ~ (item.name | default('Inconnu ' ~ item.item_type) | truncate(200, True, '‚Ä¶'))) | tojson }}
      {%- endif %},

      {#
        Description simple pour les √©l√©ments supprim√©s
        -----------------------------------------------
        Rester concis puisque le contenu est en cours de suppression
      #}
      "description": {% if item.item_type == 'Episode' -%}
        {{ ("**" ~ (item.series_name | default('S√©rie inconnue')) ~ "**\n" ~
        "S" ~ "%02d"|format(item.season_number | default(0)) ~ "E" ~ "%02d"|format(item.episode_number | default(0)) ~ "\n" ~
        (item.name | default('√âpisode inconnu')) ~ "\n\n" ~
        "Cet √©l√©ment a √©t√© retir√© de la biblioth√®que.") | tojson }}
      {%- elif item.item_type in ['Series', 'Season'] -%}
        {{ ("**" ~ (item.name | default('Titre inconnu')) ~ "**" ~
        (" (" ~ item.year ~ ")" if item.year else "") ~ "\n\n" ~
        "Cet √©l√©ment a √©t√© retir√© de la biblioth√®que.") | tojson }}
      {%- elif item.item_type == 'Movie' -%}
        {{ ("**" ~ (item.name | default('Titre inconnu')) ~ "**" ~
        (" (" ~ item.year ~ ")" if item.year else "") ~ "\n\n" ~
        "Ce film a √©t√© retir√© de la biblioth√®que.") | tojson }}
      {%- elif item.item_type == 'Audio' -%}
        {{ ("**" ~ (item.name | default('Chanson inconnue')) ~ "**" ~
        (" par " ~ (item.artists | join(', ')) if item.artists is defined and item.artists and item.artists | length > 0 else
         " par " ~ item.album_artist if item.album_artist is defined and item.album_artist else
         "") ~
        (" de **" ~ item.album ~ "**" if item.album is defined and item.album else
         "") ~ "\n\n" ~
        "Cette piste musicale a √©t√© retir√©e de la biblioth√®que.") | tojson }}
      {%- elif item.item_type == 'MusicAlbum' -%}
        {{ ("**" ~ (item.name | default('Album inconnu')) ~ "**" ~
        (" par " ~ item.album_artist if item.album_artist is defined and item.album_artist else
         " par " ~ (item.artists | join(', ')) if item.artists is defined and item.artists and item.artists | length > 0 else
         "") ~ "\n\n" ~
        "Cet album a √©t√© retir√© de la biblioth√®que.") | tojson }}
      {%- else -%}
        {{ ("**" ~ (item.name | default('Titre inconnu')) ~ "**\n\n" ~
        "Cet √©l√©ment a √©t√© retir√© de la biblioth√®que.") | tojson }}
      {%- endif %},

      "color": {{ color }},

      {#
        Champs minimaux pour les √©l√©ments supprim√©s
        --------------------------------------------
        Afficher seulement les informations essentielles car l'√©l√©ment a disparu
      #}
      {% set field_count = namespace(value=0) %}
      "fields": [
        {# Champ Type d'√©l√©ment #}
        {% if item.item_type and field_count.value < 25 -%}
          {% if field_count.value > 0 %},{% endif %}
          {% set field_count.value = field_count.value + 1 %}
          {
            "name": "üìÅ Type :",
            "value": {{ item.item_type | tojson }},
            "inline": true
          }
        {%- endif %}

        {# Champ Ann√©e pour Films/S√©ries #}
        {% if item.year and item.item_type in ['Movie', 'Series'] and field_count.value < 25 -%}
          {% if field_count.value > 0 %},{% endif %}
          {% set field_count.value = field_count.value + 1 %}
        ,{
            "name": "üìÖ Ann√©e :",
            "value": {{ item.year | tojson }},
            "inline": true
          }
        {%- endif %}

        {# Champ Genre #}
        {% if item.genres and item.genres | length > 0 and field_count.value < 25 -%}
          {% if field_count.value > 0 %},{% endif %}
          {% set field_count.value = field_count.value + 1 %}
        ,{
            "name": "üé≠ Genres :",
            "value": {{ (item.genres[:3] | join(', ')) | truncate(100, True, '‚Ä¶') | tojson }},
            "inline": true
          }
        {%- endif %}

        {# Chemin du fichier si disponible #}
        {% if item.file_path and field_count.value < 25 -%}
          {% if field_count.value > 0 %},{% endif %}
          {% set field_count.value = field_count.value + 1 %}
        ,{
            "name": "üìÇ Chemin :",
            "value": {{ item.file_path | truncate(100, True, '‚Ä¶') | tojson }},
            "inline": false
          }
        {%- endif %}

        {# Horodatage de suppression #}
        {% if field_count.value < 25 -%}
          {% if field_count.value > 0 %},{% endif %}
          {% set field_count.value = field_count.value + 1 %}
        ,{
            "name": "üïê Supprim√© le :",
            "value": "<t:{{ item.date_created | default(item.timestamp_created) | int }}:R>",
            "inline": true
          }
        {%- endif %}
      ],

      {#
        Informations de pied de page
        -----------------------------
        Afficher les informations du serveur et l'horodatage
      #}
      "footer": {
        "text": {{ (item.server_name | default('Jellyfin Server')) | tojson }}
        {% if item.server_version -%}
          ,
          "icon_url": "https://raw.githubusercontent.com/jellyfin/jellyfin-ux/master/branding/SVG/icon-transparent.svg"
        {%- endif %}
      },

      {#
        Horodatage
        -----------
        Utiliser l'horodatage actuel pour l'√©v√©nement de suppression
      #}
      "timestamp": {{ item.timestamp | tojson }}

      {#
        Pas de miniature pour les √©l√©ments supprim√©s car le contenu a disparu
      #}
    }
  ]
}