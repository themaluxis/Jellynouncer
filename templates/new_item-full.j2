{#
  New Item Full Template for Jellynouncer
  ========================================

  Comprehensive notification with all available metadata.
  Uses all 25 available fields to show maximum information.

  Includes: All ratings, cast, crew, production info, awards, etc.
#}
{
  "embeds": [
    {
      "title": {{ ("ğŸ†•" ~ 
        ("ğŸ“º " ~ (item.name | default('Unknown Episode') | truncate(200, True, '...')) if item.item_type == 'Episode' else
         "ğŸ“º " ~ (item.name | default('Unknown Series') | truncate(200, True, '...')) if item.item_type == 'Series' else
         "ğŸ¬ " ~ (item.name | default('Unknown Movie') | truncate(200, True, '...')) if item.item_type == 'Movie' else
         "ğŸ“º " ~ (item.series_name | default('Unknown Series')) ~ " - Season " ~ (item.season_number | default('?') | string) if item.item_type == 'Season' else
         "ğŸµ " ~ (item.name | default('Unknown Song') | truncate(200, True, '...')) if item.item_type == 'Audio' else
         "ğŸ’¿ " ~ (item.name | default('Unknown Album') | truncate(200, True, '...')) if item.item_type == 'MusicAlbum' else
         "ğŸ¤ " ~ (item.name | default('Unknown Artist') | truncate(200, True, '...')) if item.item_type == 'MusicArtist' else
         "ğŸ“· " ~ (item.name | default('New Photo') | truncate(200, True, '...')) if item.item_type == 'Photo' else
         "ğŸ“ " ~ (item.name | default('Unknown ' ~ item.item_type) | truncate(200, True, '...'))
        )) | tojson }},

      {#
        Full Description with All Available Info
        -----------------------------------------
        Uses maximum description length with full plot/overview
      #}
      "description": {{ (
        ("**" ~ (item.series_name | default('Unknown Series')) ~ "**\n" ~
         "S" ~ ("%02d" % (item.season_number | default(0))) ~ "E" ~ ("%02d" % (item.episode_number | default(0))) ~ "\n" ~
         (item.name | default('Unknown Episode')) ~
         ("\n*Originally aired: " ~ item.air_time ~ "*" if item.air_time else "") ~
         ("\n\n" ~ ((item.tvdb.overview[:800] + '...') if item.tvdb.overview | length > 800 else item.tvdb.overview) if item.tvdb and item.tvdb.overview
          else "\n\n" ~ ((item.overview[:800] + '...') if item.overview | length > 800 else item.overview) if item.overview
          else "")
        ) if item.item_type == 'Episode' else
        ("**" ~ (item.name | default('Unknown Title')) ~ "**" ~
         (" (" ~ item.year ~ ")" if item.year else "") ~
         ("\n*\"" ~ item.tmdb.tagline ~ "\"*" if item.tmdb and item.tmdb.tagline else "") ~
         ("\n\n" ~ ((item.tmdb.overview[:800] + '...') if item.tmdb.overview | length > 800 else item.tmdb.overview) if item.tmdb and item.tmdb.overview
          else "\n\n" ~ ((item.omdb.plot[:800] + '...') if item.omdb.plot | length > 800 else item.omdb.plot) if item.omdb and item.omdb.plot and item.omdb.plot != 'N/A'
          else "\n\n" ~ ((item.overview[:800] + '...') if item.overview | length > 800 else item.overview) if item.overview
          else "")
        ) if item.item_type == 'Movie' else
        ("**" ~ (item.name | default('Unknown Title')) ~ "**" ~
         ("\n\n" ~ ((item.overview[:800] + '...') if item.overview | length > 800 else item.overview) if item.overview else "")
        )
      ) | tojson }},

      "color": {{ color }},

      {#
        Maximum Fields with All Metadata
        ---------------------------------
        Use all 25 fields to show comprehensive information
      #}
      "fields": [
        {% set fields_added = namespace(count=0) %}

        {# Technical specs - up to 6 fields #}
        {% if item.video_height and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“ Quality",
          "value": {{ ((item.video_height | string) ~ "p" ~
            (" " ~ item.video_range if item.video_range and item.video_range != 'SDR' else "")
          ) | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.video_codec and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸï¸ Video Codec",
          "value": {{ ((item.video_codec | upper) ~
            (" " ~ item.video_profile if item.video_profile else "") ~
            (" @ " ~ ((item.video_bitrate / 1000000) | round(1) | string) ~ " Mbps" if item.video_bitrate else "")
          ) | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.audio_codec and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ”Š Audio",
          "value": {{ ((item.audio_codec | upper) ~
            (" Stereo" if item.audio_channels == 2
             else " 5.1" if item.audio_channels == 6
             else " 7.1" if item.audio_channels == 8
             else " " ~ (item.audio_channels | string) ~ "ch" if item.audio_channels
             else "") ~
            (" @ " ~ ((item.audio_bitrate / 1000) | round(0) | string) ~ " kbps" if item.audio_bitrate else "")
          ) | tojson }},
          "inline": true
        }
        {% endif %}

        {# Content information - up to 6 fields #}
        {% if (item.runtime_ticks or (item.omdb and item.omdb.runtime_minutes)) and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "â±ï¸ Runtime",
          "value": {{ (
            (((item.runtime_ticks / 600000000) | int / 60) | int | string) ~ "h " ~ ((((item.runtime_ticks / 600000000) | int) % 60) | string) ~ "m"
            if item.runtime_ticks and ((item.runtime_ticks / 600000000) | int / 60) | int > 0
            else (((item.runtime_ticks / 600000000) | int) | string) ~ " min"
            if item.runtime_ticks
            else ((item.omdb.runtime_minutes / 60) | int | string) ~ "h " ~ (((item.omdb.runtime_minutes % 60)) | string) ~ "m"
            if item.omdb and item.omdb.runtime_minutes and (item.omdb.runtime_minutes / 60) | int > 0
            else (item.omdb.runtime_minutes | string) ~ " min"
            if item.omdb and item.omdb.runtime_minutes
            else ""
          ) | tojson }},
          "inline": true
        }
        {% endif %}

        {# Genres with metadata priority #}
        {% set display_genres = null %}
        {% if item.item_type in ['Series', 'Season', 'Episode'] %}
          {% if item.tvdb and item.tvdb.genres %}
            {% set display_genres = item.tvdb.genres %}
          {% elif item.genres %}
            {% set display_genres = item.genres %}
          {% endif %}
        {% elif item.item_type == 'Movie' %}
          {% if item.tmdb and item.tmdb.genres_list %}
            {% set display_genres = item.tmdb.genres_list %}
          {% elif item.omdb and item.omdb.genres_list %}
            {% set display_genres = item.omdb.genres_list %}
          {% elif item.genres %}
            {% set display_genres = item.genres %}
          {% endif %}
        {% elif item.genres %}
          {% set display_genres = item.genres %}
        {% endif %}

        {% if display_genres and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ­ Genres",
          "value": {{ (display_genres | join(', ')) | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.file_size and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ’¾ File Size",
          "value": {{ (("%.2f" % (item.file_size / 1073741824)) ~ " GB") | tojson }},
          "inline": true
        }
        {% endif %}

        {# Comprehensive inline ratings display #}
        {% set has_ratings = false %}
        {% if (item.omdb and (item.omdb.imdb_rating or item.omdb.metascore or
               item.omdb.ratings_dict.rotten_tomatoes)) or
               (item.tmdb and item.tmdb.rating_display) or
               (item.tvdb and item.tvdb.rating) %}
          {% set has_ratings = true %}
        {% endif %}

        {% if has_ratings and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "â­ Ratings",
          "value": {{ (
            {%- set rating_parts = [] -%}
            {%- if item.omdb and item.omdb.imdb_rating and item.omdb.imdb_rating != 'N/A' -%}
              {%- set _ = rating_parts.append('**IMDb:** ' ~ item.omdb.imdb_rating ~ '/10') -%}
            {%- endif -%}
            {%- if item.omdb and item.omdb.ratings_dict.rotten_tomatoes -%}
              {%- set _ = rating_parts.append('**RT:** ' ~ item.omdb.ratings_dict.rotten_tomatoes.value) -%}
            {%- endif -%}
            {%- if item.omdb and item.omdb.metascore and item.omdb.metascore != 'N/A' -%}
              {%- set _ = rating_parts.append('**MC:** ' ~ item.omdb.metascore ~ '/100') -%}
            {%- endif -%}
            {%- if item.tmdb and item.tmdb.rating_display -%}
              {%- set _ = rating_parts.append('**TMDb:** ' ~ item.tmdb.rating_display ~ '/10') -%}
            {%- elif item.omdb and item.omdb.ratings_dict.tmdb -%}
              {%- set _ = rating_parts.append('**TMDb:** ' ~ item.omdb.ratings_dict.tmdb.value) -%}
            {%- endif -%}
            {%- if item.tvdb and item.tvdb.rating -%}
              {%- set _ = rating_parts.append('**TVDb:** ' ~ item.tvdb.rating ~ '/10') -%}
            {%- endif -%}
            rating_parts | join(' â€¢ ')
          ) | tojson }},
          "inline": false
        }
        {% endif %}

        {# Cast and Crew - up to 4 fields #}
        {% if item.omdb and item.omdb.director and item.omdb.director != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ¬ Director",
          "value": {{ item.omdb.director | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.omdb and item.omdb.actors and item.omdb.actors != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ­ Cast",
          "value": {{ ((item.omdb.actors[:200] + '...') if item.omdb.actors | length > 200 else item.omdb.actors) | tojson }},
          "inline": false
        }
        {% endif %}

        {% if item.omdb and item.omdb.writer and item.omdb.writer != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "âœï¸ Writer",
          "value": {{ ((item.omdb.writer[:200] + '...') if item.omdb.writer | length > 200 else item.omdb.writer) | tojson }},
          "inline": true
        }
        {% endif %}

        {# Production information - up to 5 fields #}
        {% if item.omdb and item.omdb.awards and item.omdb.awards != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ† Awards",
          "value": {{ item.omdb.awards | tojson }},
          "inline": false
        }
        {% endif %}

        {% if item.tmdb and item.tmdb.budget and item.tmdb.budget > 0 and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ’° Budget",
          "value": {{ ("$" ~ '{:,.0f}'.format(item.tmdb.budget)) | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.tmdb and item.tmdb.revenue and item.tmdb.revenue > 0 and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“ˆ Revenue",
          "value": {{ ("$" ~ '{:,.0f}'.format(item.tmdb.revenue)) | tojson }},
          "inline": true
        }
        {% elif item.omdb and item.omdb.box_office and item.omdb.box_office != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“ˆ Box Office",
          "value": {{ item.omdb.box_office | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.omdb and item.omdb.production and item.omdb.production != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ¬ Production",
          "value": {{ item.omdb.production | tojson }},
          "inline": true
        }
        {% endif %}

        {# Release information #}
        {% if item.omdb and item.omdb.released and item.omdb.released != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“… Released",
          "value": {{ item.omdb.released | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.omdb and item.omdb.rated and item.omdb.rated != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ” Rated",
          "value": {{ item.omdb.rated | tojson }},
          "inline": true
        }
        {% endif %}

        {# Language and country #}
        {% if item.omdb and item.omdb.language and item.omdb.language != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ—£ï¸ Language",
          "value": {{ item.omdb.language | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.omdb and item.omdb.country and item.omdb.country != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸŒ Country",
          "value": {{ item.omdb.country | tojson }},
          "inline": true
        }
        {% endif %}

        {# TV-specific fields #}
        {% if item.tvdb and item.tvdb.status and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“º Status",
          "value": {{ item.tvdb.status | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.tvdb and item.tvdb.average_runtime and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "â±ï¸ Avg Runtime",
          "value": {{ ((item.tvdb.average_runtime | string) ~ " min") | tojson }},
          "inline": true
        }
        {% endif %}

        {# External IDs for reference #}
        {% if (item.imdb_id or item.tmdb_id or item.tvdb_id) and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ”— External IDs",
          "value": {{ (
            {%- set id_parts = [] -%}
            {%- if item.imdb_id %}{% set _ = id_parts.append('[IMDb](https://www.imdb.com/title/' ~ item.imdb_id ~ '/)') %}{% endif -%}
            {%- if item.tmdb_id and item.item_type == 'Movie' %}{% set _ = id_parts.append('[TMDb](https://www.themoviedb.org/movie/' ~ item.tmdb_id ~ ')') %}{% endif -%}
            {%- if item.tmdb_id and item.item_type in ['Series', 'Season', 'Episode'] %}{% set _ = id_parts.append('[TMDb](https://www.themoviedb.org/tv/' ~ item.tmdb_id ~ ')') %}{% endif -%}
            {%- if item.tvdb_id %}{% set _ = id_parts.append('[TVDb](https://thetvdb.com/series/' ~ item.tvdb_id ~ ')') %}{% endif -%}
            id_parts | join(' â€¢ ')
          ) | tojson }},
          "inline": false
        }
        {% endif %}
      ],

      {# Image selection with priority #}
      {% if item.item_type == 'Episode' and item.series_id %}
      "thumbnail": {
        "url": {{ thumbnail_url | tojson }}
      },
      {% elif item.item_id %}
      "thumbnail": {
        "url": {{ thumbnail_url | tojson }}
      },
      {% elif item.omdb and item.omdb.poster and item.omdb.poster != 'N/A' %}
      "thumbnail": {
        "url": {{ item.omdb.poster | tojson }}
      },
      {% elif item.tvdb and item.tvdb.poster_url %}
      "thumbnail": {
        "url": {{ item.tvdb.poster_url | tojson }}
      },
      {% elif item.tmdb and item.tmdb.backdrop_url %}
      "image": {
        "url": {{ item.tmdb.backdrop_url | tojson }}
      },
      {% endif %}

      "footer": {
        "text": {{ ((item.library_name or 'Jellyfin') ~
          (" â€¢ " ~ item.server_name if item.server_name else "") ~
          (" â€¢ IMDb via OMDb" if item.omdb else "") ~
          (" â€¢ TheTVDB" if item.tvdb else "") ~
          (" â€¢ TMDb" if item.tmdb else "")
        ) | tojson }},
        "icon_url": {{ (jellyfin_url ~ "/web/favicon.png") | tojson }}
      },

      {% if item.item_id %}
      "url": {{ (jellyfin_url ~ "/web/index.html#!/details?id=" ~ item.item_id) | tojson }},
      {% endif %}

      "timestamp": {{ timestamp | tojson }}
    }
  ]
}
