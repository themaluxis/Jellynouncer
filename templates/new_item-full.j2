{#
  New Item Full Template for Jellynouncer
  ========================================

  Comprehensive notification with all available metadata.
  Uses all 25 available fields to show maximum information.

  Includes: All ratings, cast, crew, production info, awards, etc.
#}
{
  "embeds": [
    {
      "title": "ğŸ†• {% if item.item_type == 'Episode' -%}
        ğŸ“º New Episode
      {%- elif item.item_type == 'Series' -%}
        ğŸ“º New Series
      {%- elif item.item_type == 'Movie' -%}
        ğŸ¬ New Movie
      {%- else -%}
        ğŸ“ New {{ item.item_type }}
      {%- endif %} Added",

      {#
        Full Description with All Available Info
        -----------------------------------------
        Uses maximum description length with full plot/overview
      #}
      "description": "{% if item.item_type == 'Episode' -%}
        **{{ item.series_name | default('Unknown Series') }}**
        S{{ '%02d' | format(item.season_number | default(0)) }}E{{ '%02d' | format(item.episode_number | default(0)) }}
        {{ item.name | default('Unknown Episode') }}
        {%- if item.air_time %}\n*Originally aired: {{ item.air_time }}*{% endif -%}
        {%- if item.tvdb and item.tvdb.overview -%}
          \n\n{{ (item.tvdb.overview[:800] + '...') if item.tvdb.overview | length > 800 else item.tvdb.overview }}
        {%- elif item.overview -%}
          \n\n{{ (item.overview[:800] + '...') if item.overview | length > 800 else item.overview }}
        {%- endif -%}
      {%- elif item.item_type == 'Movie' -%}
        **{{ item.name | default('Unknown Title') }}**
        {%- if item.year %} ({{ item.year }}){% endif -%}
        {%- if item.tmdb and item.tmdb.tagline %}\n*"{{ item.tmdb.tagline }}"*{% endif -%}
        {%- if item.tmdb and item.tmdb.overview -%}
          \n\n{{ (item.tmdb.overview[:800] + '...') if item.tmdb.overview | length > 800 else item.tmdb.overview }}
        {%- elif item.omdb and item.omdb.plot and item.omdb.plot != 'N/A' -%}
          \n\n{{ (item.omdb.plot[:800] + '...') if item.omdb.plot | length > 800 else item.omdb.plot }}
        {%- elif item.overview -%}
          \n\n{{ (item.overview[:800] + '...') if item.overview | length > 800 else item.overview }}
        {%- endif -%}
      {%- else -%}
        **{{ item.name | default('Unknown Title') }}**
        {%- if item.overview -%}
          \n\n{{ (item.overview[:800] + '...') if item.overview | length > 800 else item.overview }}
        {%- endif -%}
      {%- endif %}",

      "color": {{ color }},

      {#
        Maximum Fields with All Metadata
        ---------------------------------
        Use all 25 fields to show comprehensive information
      #}
      "fields": [
        {% set fields_added = namespace(count=0) %}

        {# Technical specs - up to 6 fields #}
        {% if item.video_height and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“ Quality",
          "value": "{{ item.video_height }}p
            {%- if item.video_range and item.video_range != 'SDR' %} {{ item.video_range }}{% endif %}",
          "inline": true
        }
        {% endif %}

        {% if item.video_codec and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸï¸ Video Codec",
          "value": "{{ item.video_codec | upper }}
            {%- if item.video_profile %} {{ item.video_profile }}{% endif %}
            {%- if item.video_bitrate %} @ {{ (item.video_bitrate / 1000000) | round(1) }} Mbps{% endif %}",
          "inline": true
        }
        {% endif %}

        {% if item.audio_codec and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ”Š Audio",
          "value": "{{ item.audio_codec | upper }}
            {%- if item.audio_channels %}
              {%- if item.audio_channels == 2 %} Stereo
              {%- elif item.audio_channels == 6 %} 5.1
              {%- elif item.audio_channels == 8 %} 7.1
              {%- else %} {{ item.audio_channels }}ch
              {%- endif -%}
            {%- endif %}
            {%- if item.audio_bitrate %} @ {{ (item.audio_bitrate / 1000) | round(0) }} kbps{% endif %}",
          "inline": true
        }
        {% endif %}

        {# Content information - up to 6 fields #}
        {% if (item.runtime_ticks or (item.omdb and item.omdb.runtime_minutes)) and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "â±ï¸ Runtime",
          "value": "
            {%- if item.runtime_ticks -%}
              {%- set minutes = (item.runtime_ticks / 600000000) | int -%}
              {%- set hours = (minutes / 60) | int -%}
              {%- set mins = minutes % 60 -%}
              {%- if hours > 0 %}{{ hours }}h {{ mins }}m{% else %}{{ mins }} min{% endif -%}
            {%- elif item.omdb and item.omdb.runtime_minutes -%}
              {%- set hours = (item.omdb.runtime_minutes / 60) | int -%}
              {%- set mins = item.omdb.runtime_minutes % 60 -%}
              {%- if hours > 0 %}{{ hours }}h {{ mins }}m{% else %}{{ mins }} min{% endif -%}
            {%- endif %}",
          "inline": true
        }
        {% endif %}

        {# Genres with metadata priority #}
        {% set display_genres = null %}
        {% if item.item_type in ['Series', 'Season', 'Episode'] %}
          {% if item.tvdb and item.tvdb.genres %}
            {% set display_genres = item.tvdb.genres %}
          {% elif item.genres %}
            {% set display_genres = item.genres %}
          {% endif %}
        {% elif item.item_type == 'Movie' %}
          {% if item.tmdb and item.tmdb.genres %}
            {% set display_genres = item.tmdb.genres | map(attribute='name') | list %}
          {% elif item.omdb and item.omdb.genres_list %}
            {% set display_genres = item.omdb.genres_list %}
          {% elif item.genres %}
            {% set display_genres = item.genres %}
          {% endif %}
        {% elif item.genres %}
          {% set display_genres = item.genres %}
        {% endif %}

        {% if display_genres and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ­ Genres",
          "value": "{{ display_genres | join(', ') }}",
          "inline": true
        }
        {% endif %}

        {% if item.file_size and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ’¾ File Size",
          "value": "{{ '%.2f' | format(item.file_size / 1073741824) }} GB",
          "inline": true
        }
        {% endif %}

        {# Comprehensive inline ratings display #}
        {% set has_ratings = false %}
        {% if (item.omdb and (item.omdb.imdb_rating or item.omdb.metascore or
               item.omdb.ratings_dict.rotten_tomatoes)) or
               (item.tmdb and item.tmdb.vote_average) or
               (item.tvdb and item.tvdb.rating) %}
          {% set has_ratings = true %}
        {% endif %}

        {% if has_ratings and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "â­ Ratings",
          "value": "
            {%- set rating_parts = [] -%}
            {%- if item.omdb and item.omdb.imdb_rating and item.omdb.imdb_rating != 'N/A' -%}
              {%- set _ = rating_parts.append('**IMDb:** ' ~ item.omdb.imdb_rating ~ '/10') -%}
            {%- endif -%}
            {%- if item.omdb and item.omdb.ratings_dict.rotten_tomatoes -%}
              {%- set _ = rating_parts.append('**RT:** ' ~ item.omdb.ratings_dict.rotten_tomatoes.value) -%}
            {%- endif -%}
            {%- if item.omdb and item.omdb.metascore and item.omdb.metascore != 'N/A' -%}
              {%- set _ = rating_parts.append('**MC:** ' ~ item.omdb.metascore ~ '/100') -%}
            {%- endif -%}
            {%- if item.tmdb and item.tmdb.vote_average -%}
              {%- set _ = rating_parts.append('**TMDb:** ' ~ item.tmdb.vote_average ~ '/10') -%}
            {%- elif item.omdb and item.omdb.ratings_dict.tmdb -%}
              {%- set _ = rating_parts.append('**TMDb:** ' ~ item.omdb.ratings_dict.tmdb.value) -%}
            {%- endif -%}
            {%- if item.tvdb and item.tvdb.rating -%}
              {%- set _ = rating_parts.append('**TVDb:** ' ~ item.tvdb.rating ~ '/10') -%}
            {%- endif -%}
            {{ rating_parts | join(' â€¢ ') }}",
          "inline": false
        }
        {% endif %}

        {# Cast and Crew - up to 4 fields #}
        {% if item.omdb and item.omdb.director and item.omdb.director != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ¬ Director",
          "value": "{{ item.omdb.director }}",
          "inline": true
        }
        {% endif %}

        {% if item.omdb and item.omdb.actors and item.omdb.actors != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ­ Cast",
          "value": "{{ (item.omdb.actors[:200] + '...') if item.omdb.actors | length > 200 else item.omdb.actors }}",
          "inline": false
        }
        {% endif %}

        {% if item.omdb and item.omdb.writer and item.omdb.writer != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "âœï¸ Writer",
          "value": "{{ (item.omdb.writer[:200] + '...') if item.omdb.writer | length > 200 else item.omdb.writer }}",
          "inline": true
        }
        {% endif %}

        {# Production information - up to 5 fields #}
        {% if item.omdb and item.omdb.awards and item.omdb.awards != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ† Awards",
          "value": "{{ item.omdb.awards }}",
          "inline": false
        }
        {% endif %}

        {% if item.tmdb and item.tmdb.budget and item.tmdb.budget > 0 and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ’° Budget",
          "value": "${{ '{:,.0f}'.format(item.tmdb.budget) }}",
          "inline": true
        }
        {% endif %}

        {% if item.tmdb and item.tmdb.revenue and item.tmdb.revenue > 0 and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“ˆ Revenue",
          "value": "${{ '{:,.0f}'.format(item.tmdb.revenue) }}",
          "inline": true
        }
        {% elif item.omdb and item.omdb.box_office and item.omdb.box_office != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“ˆ Box Office",
          "value": "{{ item.omdb.box_office }}",
          "inline": true
        }
        {% endif %}

        {% if item.omdb and item.omdb.production and item.omdb.production != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ¬ Production",
          "value": "{{ item.omdb.production }}",
          "inline": true
        }
        {% endif %}

        {# Release information #}
        {% if item.omdb and item.omdb.released and item.omdb.released != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“… Released",
          "value": "{{ item.omdb.released }}",
          "inline": true
        }
        {% endif %}

        {% if item.omdb and item.omdb.rated and item.omdb.rated != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ” Rated",
          "value": "{{ item.omdb.rated }}",
          "inline": true
        }
        {% endif %}

        {# Language and country #}
        {% if item.omdb and item.omdb.language and item.omdb.language != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ—£ï¸ Language",
          "value": "{{ item.omdb.language }}",
          "inline": true
        }
        {% endif %}

        {% if item.omdb and item.omdb.country and item.omdb.country != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸŒ Country",
          "value": "{{ item.omdb.country }}",
          "inline": true
        }
        {% endif %}

        {# TV-specific fields #}
        {% if item.tvdb and item.tvdb.status and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“º Status",
          "value": "{{ item.tvdb.status }}",
          "inline": true
        }
        {% endif %}

        {% if item.tvdb and item.tvdb.average_runtime and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "â±ï¸ Avg Runtime",
          "value": "{{ item.tvdb.average_runtime }} min",
          "inline": true
        }
        {% endif %}

        {# External IDs for reference #}
        {% if (item.imdb_id or item.tmdb_id or item.tvdb_id) and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ”— External IDs",
          "value": "
            {%- set id_parts = [] -%}
            {%- if item.imdb_id %}{% set _ = id_parts.append('[IMDb](https://www.imdb.com/title/' ~ item.imdb_id ~ '/)') %}{% endif -%}
            {%- if item.tmdb_id and item.item_type == 'Movie' %}{% set _ = id_parts.append('[TMDb](https://www.themoviedb.org/movie/' ~ item.tmdb_id ~ ')') %}{% endif -%}
            {%- if item.tmdb_id and item.item_type in ['Series', 'Season', 'Episode'] %}{% set _ = id_parts.append('[TMDb](https://www.themoviedb.org/tv/' ~ item.tmdb_id ~ ')') %}{% endif -%}
            {%- if item.tvdb_id %}{% set _ = id_parts.append('[TVDb](https://thetvdb.com/series/' ~ item.tvdb_id ~ ')') %}{% endif -%}
            {{ id_parts | join(' â€¢ ') }}",
          "inline": false
        }
        {% endif %}
      ],

      {# Image selection with priority #}
      {% if item.item_type == 'Episode' and item.series_id %}
      "thumbnail": {
        "url": "{{ thumbnail_url }}"
      },
      {% elif item.item_id %}
      "thumbnail": {
        "url": "{{ thumbnail_url }}"
      },
      {% elif item.omdb and item.omdb.poster and item.omdb.poster != 'N/A' %}
      "thumbnail": {
        "url": "{{ item.omdb.poster }}"
      },
      {% elif item.tvdb and item.tvdb.poster_url %}
      "thumbnail": {
        "url": "{{ item.tvdb.poster_url }}"
      },
      {% elif item.tmdb and item.tmdb.backdrop_url %}
      "image": {
        "url": "{{ item.tmdb.backdrop_url }}"
      },
      {% endif %}

      "footer": {
        "text": "{{ item.library_name or 'Jellyfin' }}
          {%- if item.server_name %} â€¢ {{ item.server_name }}{% endif %}
          {%- if item.omdb %} â€¢ IMDb via OMDb{% endif %}
          {%- if item.tvdb %} â€¢ TheTVDB{% endif %}
          {%- if item.tmdb %} â€¢ TMDb{% endif %}",
        "icon_url": "{{ jellyfin_url }}/web/favicon.png"
      },

      {% if item.item_id %}
      "url": "{{ jellyfin_url }}/web/index.html#!/details?id={{ item.item_id }}",
      {% endif %}

      "timestamp": "{{ timestamp }}"
    }
  ]
}