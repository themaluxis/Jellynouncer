{#
  ModÃ¨le Complet de Nouvel Ã‰lÃ©ment pour Jellynouncer
  ===================================================

  Notification complÃ¨te avec toutes les mÃ©tadonnÃ©es disponibles.
  Utilise les 25 champs disponibles pour afficher un maximum d'informations.

  Inclut : Toutes les notes, casting, Ã©quipe, informations de production, rÃ©compenses, etc.
#}
{
  "embeds": [
    {
      "title": {{ ("ğŸ†•" ~ 
        ("ğŸ“º " ~ (item.name | default('Ã‰pisode inconnu') | truncate(200, True, 'â€¦')) if item.item_type == 'Episode' else
         "ğŸ“º " ~ (item.name | default('SÃ©rie inconnue') | truncate(200, True, 'â€¦')) if item.item_type == 'Series' else
         "ğŸ¬ " ~ (item.name | default('Film inconnu') | truncate(200, True, 'â€¦')) if item.item_type == 'Movie' else
         "ğŸ“º " ~ (item.series_name | default('SÃ©rie inconnue')) ~ " - Saison " ~ (item.season_number | default('?') | string) if item.item_type == 'Season' else
         "ğŸµ " ~ (item.name | default('Chanson inconnue') | truncate(200, True, 'â€¦')) if item.item_type == 'Audio' else
         "ğŸ’¿ " ~ (item.name | default('Album inconnu') | truncate(200, True, 'â€¦')) if item.item_type == 'MusicAlbum' else
         "ğŸ¤ " ~ (item.name | default('Artiste inconnu') | truncate(200, True, 'â€¦')) if item.item_type == 'MusicArtist' else
         "ğŸ“· " ~ (item.name | default('Nouvelle photo') | truncate(200, True, 'â€¦')) if item.item_type == 'Photo' else
         "ğŸ“ " ~ (item.name | default(item.item_type ~ ' inconnu') | truncate(200, True, 'â€¦'))
        )) | tojson }},

      {#
        Description ComplÃ¨te avec Toutes les Informations Disponibles
        ---------------------------------------------------------------
        Utilise la longueur maximale de description avec le rÃ©sumÃ©/aperÃ§u complet
      #}
      "description": {{ (
        ("**" ~ (item.series_name | default('SÃ©rie Inconnue')) ~ "**\n" ~
         "S" ~ ("%02d" % (item.season_number | default(0))) ~ "E" ~ ("%02d" % (item.episode_number | default(0))) ~ "\n" ~
         (item.name | default('Ã‰pisode Inconnu')) ~
         ("\n*Diffusion originale : " ~ item.air_time ~ "*" if item.air_time else "") ~
         ("\n\n" ~ ((item.tvdb.overview[:800] + '...') if item.tvdb.overview | length > 800 else item.tvdb.overview) if item.tvdb and item.tvdb.overview
          else "\n\n" ~ ((item.overview[:800] + '...') if item.overview | length > 800 else item.overview) if item.overview
          else "")
        ) if item.item_type == 'Episode' else
        ("**" ~ (item.name | default('Titre Inconnu')) ~ "**" ~
         (" (" ~ item.year ~ ")" if item.year else "") ~
         ("\n*\"" ~ item.tmdb.tagline ~ "\"*" if item.tmdb and item.tmdb.tagline else "") ~
         ("\n\n" ~ ((item.tmdb.overview[:800] + '...') if item.tmdb.overview | length > 800 else item.tmdb.overview) if item.tmdb and item.tmdb.overview
          else "\n\n" ~ ((item.omdb.plot[:800] + '...') if item.omdb.plot | length > 800 else item.omdb.plot) if item.omdb and item.omdb.plot and item.omdb.plot != 'N/A'
          else "\n\n" ~ ((item.overview[:800] + '...') if item.overview | length > 800 else item.overview) if item.overview
          else "")
        ) if item.item_type == 'Movie' else
        ("**" ~ (item.name | default('Titre Inconnu')) ~ "**" ~
         ("\n\n" ~ ((item.overview[:800] + '...') if item.overview | length > 800 else item.overview) if item.overview else "")
        )
      ) | tojson }},

      "color": {{ color }},

      {#
        Champs Maximaux avec Toutes les MÃ©tadonnÃ©es
        ------------------------------------------------
        Utiliser les 25 champs pour afficher des informations complÃ¨tes
      #}
      "fields": [
        {% set fields_added = namespace(count=0) %}

        {# SpÃ©cifications techniques - jusqu'Ã  6 champs #}
        {% if item.video_height and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“ QualitÃ© :",
          "value": {{ ((item.video_height | string) ~ "p" ~
            (" " ~ item.video_range if item.video_range and item.video_range != 'SDR' else "")
          ) | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.video_codec and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸï¸ Codec vidÃ©o :",
          "value": {{ ((item.video_codec | upper) ~
            (" " ~ item.video_profile if item.video_profile else "") ~
            (" @ " ~ ((item.video_bitrate / 1000000) | round(1) | string) ~ " Mbps" if item.video_bitrate else "")
          ) | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.audio_codec and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ”Š Audio :",
          "value": {{ ((item.audio_codec | upper) ~
            (" Stereo" if item.audio_channels == 2
             else " 5.1" if item.audio_channels == 6
             else " 7.1" if item.audio_channels == 8
             else " " ~ (item.audio_channels | string) ~ "ch" if item.audio_channels
             else "") ~
            (" @ " ~ ((item.audio_bitrate / 1000) | round(0) | string) ~ " kbps" if item.audio_bitrate else "")
          ) | tojson }},
          "inline": true
        }
        {% endif %}

        {# Informations de contenu - jusqu'Ã  6 champs #}
        {% if (item.runtime_ticks or (item.omdb and item.omdb.runtime_minutes)) and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "â±ï¸ DurÃ©e :",
          "value": {{ (
            (((item.runtime_ticks / 600000000) | int / 60) | int | string) ~ "h " ~ ((((item.runtime_ticks / 600000000) | int) % 60) | string) ~ "m"
            if item.runtime_ticks and ((item.runtime_ticks / 600000000) | int / 60) | int > 0
            else (((item.runtime_ticks / 600000000) | int) | string) ~ " min"
            if item.runtime_ticks
            else ((item.omdb.runtime_minutes / 60) | int | string) ~ "h " ~ (((item.omdb.runtime_minutes % 60)) | string) ~ "m"
            if item.omdb and item.omdb.runtime_minutes and (item.omdb.runtime_minutes / 60) | int > 0
            else (item.omdb.runtime_minutes | string) ~ " min"
            if item.omdb and item.omdb.runtime_minutes
            else ""
          ) | tojson }},
          "inline": true
        }
        {% endif %}

        {# Genres avec prioritÃ© aux mÃ©tadonnÃ©es #}
        {% set display_genres = null %}
        {% if item.item_type in ['Series', 'Season', 'Episode'] %}
          {% if item.tvdb and item.tvdb.genres %}
            {% set display_genres = item.tvdb.genres %}
          {% elif item.genres %}
            {% set display_genres = item.genres %}
          {% endif %}
        {% elif item.item_type == 'Movie' %}
          {% if item.tmdb and item.tmdb.genres_list %}
            {% set display_genres = item.tmdb.genres_list %}
          {% elif item.omdb and item.omdb.genres_list %}
            {% set display_genres = item.omdb.genres_list %}
          {% elif item.genres %}
            {% set display_genres = item.genres %}
          {% endif %}
        {% elif item.genres %}
          {% set display_genres = item.genres %}
        {% endif %}

        {% if display_genres and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ­ Genres :",
          "value": {{ (display_genres | join(', ')) | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.file_size and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ’¾ Taille du Fichier",
          "value": {{ (("%.2f" % (item.file_size / 1073741824)) ~ " GB") | tojson }},
          "inline": true
        }
        {% endif %}

        {# Affichage complet des notes en ligne #}
        {% set has_ratings = false %}
        {% if (item.omdb and (item.omdb.imdb_rating or item.omdb.metascore or
               item.omdb.ratings_dict.rotten_tomatoes)) or
               (item.tmdb and item.tmdb.rating_display) or
               (item.tvdb and item.tvdb.rating) %}
          {% set has_ratings = true %}
        {% endif %}

        {% if has_ratings and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "â­ Notes :",
          "value": {{ (
            {%- set rating_parts = [] -%}
            {%- if item.omdb and item.omdb.imdb_rating and item.omdb.imdb_rating != 'N/A' -%}
              {%- set _ = rating_parts.append('**IMDb:** ' ~ item.omdb.imdb_rating ~ '/10') -%}
            {%- endif -%}
            {%- if item.omdb and item.omdb.ratings_dict.rotten_tomatoes -%}
              {%- set _ = rating_parts.append('**RT:** ' ~ item.omdb.ratings_dict.rotten_tomatoes.value) -%}
            {%- endif -%}
            {%- if item.omdb and item.omdb.metascore and item.omdb.metascore != 'N/A' -%}
              {%- set _ = rating_parts.append('**MC:** ' ~ item.omdb.metascore ~ '/100') -%}
            {%- endif -%}
            {%- if item.tmdb and item.tmdb.rating_display -%}
              {%- set _ = rating_parts.append('**TMDb:** ' ~ item.tmdb.rating_display ~ '/10') -%}
            {%- elif item.omdb and item.omdb.ratings_dict.tmdb -%}
              {%- set _ = rating_parts.append('**TMDb:** ' ~ item.omdb.ratings_dict.tmdb.value) -%}
            {%- endif -%}
            {%- if item.tvdb and item.tvdb.rating -%}
              {%- set _ = rating_parts.append('**TVDb:** ' ~ item.tvdb.rating ~ '/10') -%}
            {%- endif -%}
            rating_parts | join(' â€¢ ')
          ) | tojson }},
          "inline": false
        }
        {% endif %}

        {# Casting et Ã‰quipe - jusqu'Ã  4 champs #}
        {% if item.omdb and item.omdb.director and item.omdb.director != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ¬ RÃ©alisateur",
          "value": {{ item.omdb.director | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.omdb and item.omdb.actors and item.omdb.actors != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ­ Distribution",
          "value": {{ ((item.omdb.actors[:200] + '...') if item.omdb.actors | length > 200 else item.omdb.actors) | tojson }},
          "inline": false
        }
        {% endif %}

        {% if item.omdb and item.omdb.writer and item.omdb.writer != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "âœï¸ ScÃ©nariste",
          "value": {{ ((item.omdb.writer[:200] + '...') if item.omdb.writer | length > 200 else item.omdb.writer) | tojson }},
          "inline": true
        }
        {% endif %}

        {# Informations de production - jusqu'Ã  5 champs #}
        {% if item.omdb and item.omdb.awards and item.omdb.awards != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ† RÃ©compenses",
          "value": {{ item.omdb.awards | tojson }},
          "inline": false
        }
        {% endif %}

        {% if item.tmdb and item.tmdb.budget and item.tmdb.budget > 0 and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ’° Budget",
          "value": {{ ("$" ~ '{:,.0f}'.format(item.tmdb.budget)) | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.tmdb and item.tmdb.revenue and item.tmdb.revenue > 0 and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“ˆ Recettes",
          "value": {{ ("$" ~ '{:,.0f}'.format(item.tmdb.revenue)) | tojson }},
          "inline": true
        }
        {% elif item.omdb and item.omdb.box_office and item.omdb.box_office != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“ˆ Box-Office",
          "value": {{ item.omdb.box_office | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.omdb and item.omdb.production and item.omdb.production != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ¬ Production",
          "value": {{ item.omdb.production | tojson }},
          "inline": true
        }
        {% endif %}

        {# Informations de sortie #}
        {% if item.omdb and item.omdb.released and item.omdb.released != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“… Sorti le",
          "value": {{ item.omdb.released | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.omdb and item.omdb.rated and item.omdb.rated != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ” Classification",
          "value": {{ item.omdb.rated | tojson }},
          "inline": true
        }
        {% endif %}

        {# Langue et pays #}
        {% if item.omdb and item.omdb.language and item.omdb.language != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ—£ï¸ Langue",
          "value": {{ item.omdb.language | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.omdb and item.omdb.country and item.omdb.country != 'N/A' and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸŒ Pays",
          "value": {{ item.omdb.country | tojson }},
          "inline": true
        }
        {% endif %}

        {# Champs spÃ©cifiques TV #}
        {% if item.tvdb and item.tvdb.status and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ“º Statut",
          "value": {{ item.tvdb.status | tojson }},
          "inline": true
        }
        {% endif %}

        {% if item.tvdb and item.tvdb.average_runtime and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "â±ï¸ DurÃ©e Moyenne",
          "value": {{ ((item.tvdb.average_runtime | string) ~ " min") | tojson }},
          "inline": true
        }
        {% endif %}

        {# IDs externes pour rÃ©fÃ©rence #}
        {% if (item.imdb_id or item.tmdb_id or item.tvdb_id) and fields_added.count < 25 %}
          {% if fields_added.count > 0 %},{% endif %}
          {% set fields_added.count = fields_added.count + 1 %}
        {
          "name": "ğŸ”— IDs Externes",
          "value": {{ (
            {%- set id_parts = [] -%}
            {%- if item.imdb_id %}{% set _ = id_parts.append('[IMDb](https://www.imdb.com/title/' ~ item.imdb_id ~ '/)') %}{% endif -%}
            {%- if item.tmdb_id and item.item_type == 'Movie' %}{% set _ = id_parts.append('[TMDb](https://www.themoviedb.org/movie/' ~ item.tmdb_id ~ ')') %}{% endif -%}
            {%- if item.tmdb_id and item.item_type in ['Series', 'Season', 'Episode'] %}{% set _ = id_parts.append('[TMDb](https://www.themoviedb.org/tv/' ~ item.tmdb_id ~ ')') %}{% endif -%}
            {%- if item.tvdb_id %}{% set _ = id_parts.append('[TVDb](https://thetvdb.com/series/' ~ item.tvdb_id ~ ')') %}{% endif -%}
            id_parts | join(' â€¢ ')
          ) | tojson }},
          "inline": false
        }
        {% endif %}
      ],

      {# SÃ©lection d'image avec prioritÃ© #}
      {% if item.item_type == 'Episode' and item.series_id %}
      "thumbnail": {
        "url": {{ thumbnail_url | tojson }}
      },
      {% elif item.item_id %}
      "thumbnail": {
        "url": {{ thumbnail_url | tojson }}
      },
      {% elif item.omdb and item.omdb.poster and item.omdb.poster != 'N/A' %}
      "thumbnail": {
        "url": {{ item.omdb.poster | tojson }}
      },
      {% elif item.tvdb and item.tvdb.poster_url %}
      "thumbnail": {
        "url": {{ item.tvdb.poster_url | tojson }}
      },
      {% elif item.tmdb and item.tmdb.backdrop_url %}
      "image": {
        "url": {{ item.tmdb.backdrop_url | tojson }}
      },
      {% endif %}

      "footer": {
        "text": {{ ((item.library_name or 'Jellyfin') ~
          (" â€¢ " ~ item.server_name if item.server_name else "") ~
          (" â€¢ IMDb via OMDb" if item.omdb else "") ~
          (" â€¢ TheTVDB" if item.tvdb else "") ~
          (" â€¢ TMDb" if item.tmdb else "")
        ) | tojson }},
        "icon_url": {{ (jellyfin_url ~ "/web/favicon.png") | tojson }}
      },

      {% if item.item_id %}
      "url": {{ (jellyfin_url ~ "/web/index.html#!/details?id=" ~ item.item_id) | tojson }},
      {% endif %}

      "timestamp": {{ timestamp | tojson }}
    }
  ]
}
